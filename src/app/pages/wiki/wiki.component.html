<div class="confluence-dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <span class="app-name">Base de connaissances</span>
      </div>

      <div class="search-section">
        <div class="search-container">
          <input
            type="text"
            placeholder="Rechercher dans la base de connaissances..."
            [(ngModel)]="searchQuery"
            (keyup.enter)="search()"
            class="search-input" />
          <button class="search-btn" (click)="search()"></button>
        </div>
      </div>

    </div>
  </header>

  <div class="dashboard-body">
    <aside class="sidebar">
      <nav class="navigation">
        <ul class="nav-list">
          <li
            *ngFor="let item of navigationItems"
            class="nav-item"
            [class.active]="item.active"
            (click)="selectNavigationItem(item)">
            <span class="nav-icon">{{ item.icon }}</span>
            <span class="nav-label">{{ item.label }}</span>
          </li>
        </ul>
      </nav>

      <div class="pinned-spaces">
        <h3 class="section-title">Espaces √©pingl√©s</h3>
        <ul class="pinned-list">
          <li *ngFor="let space of pinnedSpaces" class="pinned-item">
            <span class="space-icon">{{ space.icon }}</span>
            <span class="space-name">{{ space.name }}</span>
          </li>
        </ul>
      </div>
    </aside>

    <main class="main-content">
      <section class="content-section post-creation">
        <div #postCard class="create-post-card" (click)="showEditor = true" tabindex="0">
          <div class="post-top">
            <div class="avatar">üßë</div>
            <input
              type="text"
              placeholder="Titre de l‚Äôarticle"
              [(ngModel)]="newPostTitle"
              class="post-title-input"
              (focus)="showEditor = true"
            />
          </div>

          <p-editor
            *ngIf="showEditor"
            [(ngModel)]="newPostContent"
            [style]="{height:'180px'}"
            [styleClass]="'post-editor'"
            [placeholder]="'D√©crivez votre probl√®me ou partagez votre retour d‚Äôexp√©rience...'"
          ></p-editor>
<div class="hashtag-section" *ngIf="showEditor" >
  <label for="hashtagInput">Hashtags :</label>
  <div class="hashtag-input-container">
    <input type="text" [(ngModel)]="newPostHashtagInput" placeholder="#ex: #BPMN" (keyup.enter)="addHashtag()" />
  </div>

  <div class="hashtag-list">
    <span *ngFor="let tag of hashtags" class="hashtag-chip">
      {{ tag }} <button (click)="removeHashtag(tag)">√ó</button>
    </span>
  </div>
</div>

          <input type="file" accept="image/*" (change)="onImageSelected($event)" hidden #fileInput />
<div class="post-actions-bar" *ngIf="showEditor">
  <div class="left-buttons">
    <select
      class="category-select"
      [(ngModel)]="selectedCategory"
      (change)="selectCategory(selectedCategory)">
      <option value="" disabled>Choisir une cat√©gorie</option>
      <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
    </select>

    <button class="action-btn" title="Ajouter une capture" (click)="fileInput.click()">
      <i class="fa fa-camera"></i> <span>Capture</span>
    </button>
  </div>

  <button class="publish-btn" (click)="publishPost()">Publier l‚Äôarticle</button>
</div>

        </div>
      </section>

      <section class="content-section">
        <div class="section-header">
          <h2 class="section-title">Reprenez o√π vous vous √™tes arr√™t√©</h2>
        </div>

        <div class="recent-pages-grid">
          <div
            *ngFor="let page of recentPages"
            class="recent-page-card"
            (click)="openRecentPage(page)">
            <div class="page-content">
              <h3 class="page-title">{{ page.title }}</h3>
              <div class="page-meta">
                <span class="space-name">{{ page.spaceName }}</span>
                <span class="separator">‚Ä¢</span>
                <span class="last-viewed">{{ formatDate(page.lastViewed) }} √† {{ formatTime(page.lastViewed) }}</span>
              </div>
            </div>
            <div class="page-actions">
              <button class="action-btn">‚ãØ</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Activity Section -->
      <section class="content-section">
        <div class="section-header">
          <h2 class="section-title">D√©couvrez ce qui se passe</h2>

          <div class="tabs-container">
            <div class="tabs">
              <button
                *ngFor="let cat of categories"
                class="tab"
                [class.active]="selectedCategoryFilter === cat"
                (click)="selectCategoryFilter(cat)"
              >
                {{ cat }}
              </button>
              <button
                class="tab"
                [class.active]="selectedCategoryFilter === ''"
                (click)="selectCategoryFilter('')"
                title="Afficher toutes les cat√©gories"
              >
                Tous
              </button>
<div class="hashtag-filter-bar">
  <input
    type="text"
    [(ngModel)]="searchHashtag"
    (input)="filterByHashtag()"
    placeholder="Filtrer par hashtag"
    class="hashtag-filter-input"
  />
</div>


            </div>
          </div>
        </div>

        <div class="activity-cards">
<ng-container *ngFor="let card of activityCards">
  <div *ngIf="card.hashtags?.length" class="card-hashtags">
  <span *ngFor="let tag of card.hashtags" class="hashtag-chip">{{ tag }}</span>
</div>

  <a
    *ngIf="!selectedCategoryFilter || card.category === selectedCategoryFilter"
    class="activity-card"
    [routerLink]="['/wiki', card.id]"
  >
            <div class="card-header">
              <div class="author-info">
                <div class="author-avatar">{{ card.author.charAt(0) }}</div>
                <div class="author-details">
                  <span class="author-name">{{ card.author }}</span>
                  <span class="creation-date">{{ formatDate(card.creationDate) }}</span>
                </div>
              </div>

              <div class="content-type-badge" [attr.data-type]="card.type">
                {{ card.type === 'page' ? 'üìÑ' : card.type === 'blog' ? 'üìù' : 'üí¨' }}
              </div>
            </div>

<div class="card-content">
  <div class="content-category">
    Cat√©gorie : {{ card.category || 'Non sp√©cifi√©e' }}
  </div>
  <h3 class="content-title">{{ card.title }}</h3>
  <p class="content-preview" [innerHTML]="card.content"></p>
</div>


            <div class="card-footer">
              <div class="metadata">
                <span class="owner">Propri√©taire: {{ card.owner }}</span>
                <span class="separator">‚Ä¢</span>
                <span class="space">{{ card.space }}</span>
              </div>

              <div class="card-actions">
                <button class="action-btn like-btn">üëç</button>
                <button class="action-btn comment-btn">üí¨</button>
                <button class="action-btn share-btn">üì§</button>
                <button class="action-btn more-btn">‚ãØ</button>
              </div>
            </div>
          </a>
          </ng-container>

        </div>
      </section>
    </main>
  </div>

  <button class="chatbot-button" (click)="toggleChatbot()">
    üí¨
  </button>

  <div class="chatbot-panel" *ngIf="chatbotOpen">
    <div class="chatbot-header">
      <span>Assistant IA</span>
      <button class="close-btn" (click)="toggleChatbot()">‚úñ</button>
    </div>

    <div class="chatbot-messages">
      <div *ngFor="let msg of messages" [class.user]="msg.sender === 'user'" [class.ai]="msg.sender === 'ai'">
        {{ msg.text }}
      </div>
    </div>

    <div class="chatbot-input">
      <input [(ngModel)]="userInput" placeholder="Posez votre question..." (keyup.enter)="sendMessage()" />
      <button (click)="sendMessage()">Envoyer</button>
    </div>
  </div>

  <!-- Modal pour pr√©visualisation -->
  <div class="modal-backdrop" *ngIf="selectedCard" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeModal()">‚úñ</button>
      <h2>{{ selectedCard.title }}</h2>
      <p [innerHTML]="selectedCard.content"></p>
      <img *ngIf="selectedCard.imageUrl" [src]="selectedCard.imageUrl" alt="Capture" class="modal-image" />
    </div>
  </div>
</div>
